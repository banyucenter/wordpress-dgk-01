/* Stellar.js v0.6.2 | Copyright 2014, Mark Dalgleish | http://markdalgleish.com/projects/stellar.js | http://markdalgleish.mit-license.org */ !function(e,h,A,k){function p(a,b){this.element=a;this.options=e.extend({},w,b);this._defaults=w;this._name=l;this.init()}var l="stellar",w={scrollProperty:"scroll",positionProperty:"position",horizontalScrolling:!0,verticalScrolling:!0,horizontalOffset:0,verticalOffset:0,responsive:!1,parallaxBackgrounds:!0,parallaxElements:!0,hideDistantElements:!0,hideElement:function(a){a.hide()},showElement:function(a){a.show()}},u={scroll:{getLeft:function(a){return a.scrollLeft()},setLeft:function(a,b){a.scrollLeft(b)}, getTop:function(a){return a.scrollTop()},setTop:function(a,b){a.scrollTop(b)}},position:{getLeft:function(a){return-1*parseInt(a.css("left"),10)},getTop:function(a){return-1*parseInt(a.css("top"),10)}},margin:{getLeft:function(a){return-1*parseInt(a.css("margin-left"),10)},getTop:function(a){return-1*parseInt(a.css("margin-top"),10)}},transform:{getLeft:function(a){a=getComputedStyle(a[0])[t];return"none"!==a?-1*parseInt(a.match(/(-?[0-9]+)/g)[4],10):0},getTop:function(a){a=getComputedStyle(a[0])[t]; return"none"!==a?-1*parseInt(a.match(/(-?[0-9]+)/g)[5],10):0}}},x={position:{setLeft:function(a,b){a.css("left",b)},setTop:function(a,b){a.css("top",b)}},transform:{setPosition:function(a,b,g,c,q){a[0].style[t]="translate3d("+(b-g)+"px, "+(c-q)+"px, 0)"}}},t=function(){var a,b=/^(Moz|Webkit|Khtml|O|ms|Icab)(?=[A-Z])/,g=e("script")[0].style,c="";for(a in g)if(b.test(a)){c=a.match(b)[0];break}return"WebkitOpacity"in g&&(c="Webkit"),"KhtmlOpacity"in g&&(c="Khtml"),function(a){return c+(0<c.length?a.charAt(0).toUpperCase()+ a.slice(1):a)}}()("transform"),y=e("<div />",{style:"background:#fff"}).css("background-position-x")!==k,v=y?function(a,b,g){a.css({"background-position-x":b,"background-position-y":g})}:function(a,b,g){a.css("background-position",b+" "+g)},B=y?function(a){return[a.css("background-position-x"),a.css("background-position-y")]}:function(a){return a.css("background-position").split(" ")},z=h.requestAnimationFrame||h.webkitRequestAnimationFrame||h.mozRequestAnimationFrame||h.oRequestAnimationFrame||h.msRequestAnimationFrame|| function(a){setTimeout(a,1E3/60)};p.prototype={init:function(){this.options.name=l+"_"+Math.floor(1E9*Math.random());this._defineElements();this._defineGetters();this._defineSetters();this._handleWindowLoadAndResize();this._detectViewport();this.refresh({firstLoad:!0});"scroll"===this.options.scrollProperty?this._handleScrollEvent():this._startAnimationLoop()},_defineElements:function(){this.element===A.body&&(this.element=h);this.$scrollElement=e(this.element);this.$element=this.element===h?e("body"): this.$scrollElement;this.$viewportElement=this.options.viewportElement!==k?e(this.options.viewportElement):this.$scrollElement[0]===h||"scroll"===this.options.scrollProperty?this.$scrollElement:this.$scrollElement.parent()},_defineGetters:function(){var a=this,b=u[a.options.scrollProperty];this._getScrollLeft=function(){return b.getLeft(a.$scrollElement)};this._getScrollTop=function(){return b.getTop(a.$scrollElement)}},_defineSetters:function(){var a=this,b=u[a.options.scrollProperty],g=x[a.options.positionProperty], c=b.setLeft,q=b.setTop;this._setScrollLeft="function"==typeof c?function(b){c(a.$scrollElement,b)}:e.noop;this._setScrollTop="function"==typeof q?function(b){q(a.$scrollElement,b)}:e.noop;this._setPosition=g.setPosition||function(b,c,q,e,d){a.options.horizontalScrolling&&g.setLeft(b,c,q);a.options.verticalScrolling&&g.setTop(b,e,d)}},_handleWindowLoadAndResize:function(){var a=this,b=e(h);a.options.responsive&&b.bind("load."+this.name,function(){a.refresh()});b.bind("resize."+this.name,function(){a._detectViewport(); a.options.responsive&&a.refresh()})},refresh:function(a){var b=this,g=b._getScrollLeft(),c=b._getScrollTop();a&&a.firstLoad||this._reset();this._setScrollLeft(0);this._setScrollTop(0);this._setOffsets();this._findParticles();this._findBackgrounds();a&&a.firstLoad&&/WebKit/.test(navigator.userAgent)&&e(h).load(function(){var a=b._getScrollLeft(),c=b._getScrollTop();b._setScrollLeft(a+1);b._setScrollTop(c+1);b._setScrollLeft(a);b._setScrollTop(c)});this._setScrollLeft(g);this._setScrollTop(c)},_detectViewport:function(){var a= this.$viewportElement.offset(),b=null!==a&&a!==k;this.viewportWidth=this.$viewportElement.width();this.viewportHeight=this.$viewportElement.height();this.viewportOffsetTop=b?a.top:0;this.viewportOffsetLeft=b?a.left:0},_findParticles:function(){var a=this;this._getScrollLeft();this._getScrollTop();if(this.particles!==k)for(var b=this.particles.length-1;0<=b;b--)this.particles[b].$element.data("stellar-elementIsActive",k);this.particles=[];this.options.parallaxElements&&this.$element.find("[data-stellar-ratio]").each(function(){var b, c=e(this),q=0,f=0,n=0,h=0;if(c.data("stellar-elementIsActive")){if(c.data("stellar-elementIsActive")!==this)return}else c.data("stellar-elementIsActive",this);a.options.showElement(c);c.data("stellar-startingLeft")?(c.css("left",c.data("stellar-startingLeft")),c.css("top",c.data("stellar-startingTop"))):(c.data("stellar-startingLeft",c.css("left")),c.data("stellar-startingTop",c.css("top")));var l=c.position().left;var d=c.position().top;var m="auto"===c.css("margin-left")?0:parseInt(c.css("margin-left"), 10);var r="auto"===c.css("margin-top")?0:parseInt(c.css("margin-top"),10);m=c.offset().left-m;var C=c.offset().top-r;c.parents().each(function(){var a=e(this);return!0===a.data("stellar-offset-parent")?(q=n,f=h,b=a,!1):(n+=a.position().left,void(h+=a.position().top))});r=c.data("stellar-horizontal-offset")!==k?c.data("stellar-horizontal-offset"):b!==k&&b.data("stellar-horizontal-offset")!==k?b.data("stellar-horizontal-offset"):a.horizontalOffset;var p=c.data("stellar-vertical-offset")!==k?c.data("stellar-vertical-offset"): b!==k&&b.data("stellar-vertical-offset")!==k?b.data("stellar-vertical-offset"):a.verticalOffset;a.particles.push({$element:c,$offsetParent:b,isFixed:"fixed"===c.css("position"),horizontalOffset:r,verticalOffset:p,startingPositionLeft:l,startingPositionTop:d,startingOffsetLeft:m,startingOffsetTop:C,parentOffsetLeft:q,parentOffsetTop:f,stellarRatio:c.data("stellar-ratio")!==k?c.data("stellar-ratio"):1,width:c.outerWidth(!0),height:c.outerHeight(!0),isHidden:!1})})},_findBackgrounds:function(){var a, b=this,g=this._getScrollLeft(),c=this._getScrollTop();this.backgrounds=[];this.options.parallaxBackgrounds&&(a=this.$element.find("[data-stellar-background-ratio]"),this.$element.data("stellar-background-ratio")&&(a=a.add(this.$element)),a.each(function(){var a,f=e(this),n=B(f),h=0,l=0,d=0,m=0;if(f.data("stellar-backgroundIsActive")){if(f.data("stellar-backgroundIsActive")!==this)return}else f.data("stellar-backgroundIsActive",this);f.data("stellar-backgroundStartingLeft")?v(f,f.data("stellar-backgroundStartingLeft"), f.data("stellar-backgroundStartingTop")):(f.data("stellar-backgroundStartingLeft",n[0]),f.data("stellar-backgroundStartingTop",n[1]));var r="auto"===f.css("margin-left")?0:parseInt(f.css("margin-left"),10);var p="auto"===f.css("margin-top")?0:parseInt(f.css("margin-top"),10);r=f.offset().left-r-g;var t=f.offset().top-p-c;f.parents().each(function(){var b=e(this);return!0===b.data("stellar-offset-parent")?(h=d,l=m,a=b,!1):(d+=b.position().left,void(m+=b.position().top))});p=f.data("stellar-horizontal-offset")!== k?f.data("stellar-horizontal-offset"):a!==k&&a.data("stellar-horizontal-offset")!==k?a.data("stellar-horizontal-offset"):b.horizontalOffset;var u=f.data("stellar-vertical-offset")!==k?f.data("stellar-vertical-offset"):a!==k&&a.data("stellar-vertical-offset")!==k?a.data("stellar-vertical-offset"):b.verticalOffset;b.backgrounds.push({$element:f,$offsetParent:a,isFixed:"fixed"===f.css("background-attachment"),horizontalOffset:p,verticalOffset:u,startingValueLeft:n[0],startingValueTop:n[1],startingBackgroundPositionLeft:isNaN(parseInt(n[0], 10))?0:parseInt(n[0],10),startingBackgroundPositionTop:isNaN(parseInt(n[1],10))?0:parseInt(n[1],10),startingPositionLeft:f.position().left,startingPositionTop:f.position().top,startingOffsetLeft:r,startingOffsetTop:t,parentOffsetLeft:h,parentOffsetTop:l,stellarRatio:f.data("stellar-background-ratio")===k?1:f.data("stellar-background-ratio")})}))},_reset:function(){var a;for(a=this.particles.length-1;0<=a;a--){var b=this.particles[a];var g=b.$element.data("stellar-startingLeft");var c=b.$element.data("stellar-startingTop"); this._setPosition(b.$element,g,g,c,c);this.options.showElement(b.$element);b.$element.data("stellar-startingLeft",null).data("stellar-elementIsActive",null).data("stellar-backgroundIsActive",null)}for(a=this.backgrounds.length-1;0<=a;a--)b=this.backgrounds[a],b.$element.data("stellar-backgroundStartingLeft",null).data("stellar-backgroundStartingTop",null),v(b.$element,b.startingValueLeft,b.startingValueTop)},destroy:function(){this._reset();this.$scrollElement.unbind("resize."+this.name).unbind("scroll."+ this.name);this._animationLoop=e.noop;e(h).unbind("load."+this.name).unbind("resize."+this.name)},_setOffsets:function(){var a=this,b=e(h);b.unbind("resize.horizontal-"+this.name).unbind("resize.vertical-"+this.name);"function"==typeof this.options.horizontalOffset?(this.horizontalOffset=this.options.horizontalOffset(),b.bind("resize.horizontal-"+this.name,function(){a.horizontalOffset=a.options.horizontalOffset()})):this.horizontalOffset=this.options.horizontalOffset;"function"==typeof this.options.verticalOffset? (this.verticalOffset=this.options.verticalOffset(),b.bind("resize.vertical-"+this.name,function(){a.verticalOffset=a.options.verticalOffset()})):this.verticalOffset=this.options.verticalOffset},_repositionElements:function(){var a,b,g,c,e,f=this._getScrollLeft(),h=this._getScrollTop(),k=!0,l=!0;if(this.currentScrollLeft!==f||this.currentScrollTop!==h||this.currentWidth!==this.viewportWidth||this.currentHeight!==this.viewportHeight){this.currentScrollLeft=f;this.currentScrollTop=h;this.currentWidth= this.viewportWidth;this.currentHeight=this.viewportHeight;for(e=this.particles.length-1;0<=e;e--){var d=this.particles[e];var m=d.isFixed?1:0;this.options.horizontalScrolling?(a=(f+d.horizontalOffset+this.viewportOffsetLeft+d.startingPositionLeft-d.startingOffsetLeft+d.parentOffsetLeft)*-(d.stellarRatio+m-1)+d.startingPositionLeft,g=a-d.startingPositionLeft+d.startingOffsetLeft):(a=d.startingPositionLeft,g=d.startingOffsetLeft);this.options.verticalScrolling?(b=(h+d.verticalOffset+this.viewportOffsetTop+ d.startingPositionTop-d.startingOffsetTop+d.parentOffsetTop)*-(d.stellarRatio+m-1)+d.startingPositionTop,c=b-d.startingPositionTop+d.startingOffsetTop):(b=d.startingPositionTop,c=d.startingOffsetTop);this.options.hideDistantElements&&(l=!this.options.horizontalScrolling||g+d.width>(d.isFixed?0:f)&&g<(d.isFixed?0:f)+this.viewportWidth+this.viewportOffsetLeft,k=!this.options.verticalScrolling||c+d.height>(d.isFixed?0:h)&&c<(d.isFixed?0:h)+this.viewportHeight+this.viewportOffsetTop);l&&k?(d.isHidden&& (this.options.showElement(d.$element),d.isHidden=!1),this._setPosition(d.$element,a,d.startingPositionLeft,b,d.startingPositionTop)):d.isHidden||(this.options.hideElement(d.$element),d.isHidden=!0)}for(e=this.backgrounds.length-1;0<=e;e--)d=this.backgrounds[e],m=d.isFixed?0:1,a=this.options.horizontalScrolling?(f+d.horizontalOffset-this.viewportOffsetLeft-d.startingOffsetLeft+d.parentOffsetLeft-d.startingBackgroundPositionLeft)*(m-d.stellarRatio)+"px":d.startingValueLeft,m=this.options.verticalScrolling? (h+d.verticalOffset-this.viewportOffsetTop-d.startingOffsetTop+d.parentOffsetTop-d.startingBackgroundPositionTop)*(m-d.stellarRatio)+"px":d.startingValueTop,v(d.$element,a,m)}},_handleScrollEvent:function(){var a=this,b=!1,e=function(){a._repositionElements();b=!1},c=function(){b||(z(e),b=!0)};this.$scrollElement.bind("scroll."+this.name,c);c()},_startAnimationLoop:function(){var a=this;this._animationLoop=function(){z(a._animationLoop);a._repositionElements()};this._animationLoop()}};e.fn[l]=function(a){var b= arguments;return a===k||"object"==typeof a?this.each(function(){e.data(this,"plugin_"+l)||e.data(this,"plugin_"+l,new p(this,a))}):"string"==typeof a&&"_"!==a[0]&&"init"!==a?this.each(function(){var g=e.data(this,"plugin_"+l);g instanceof p&&"function"==typeof g[a]&&g[a].apply(g,Array.prototype.slice.call(b,1));"destroy"===a&&e.data(this,"plugin_"+l,null)}):void 0};e[l]=function(){var a=e(h);return a.stellar.apply(a,Array.prototype.slice.call(arguments,0))};e[l].scrollProperty=u;e[l].positionProperty= x;h.Stellar=p}(jQuery,this,document);